const MessageRenderer={createMessageElement(username,message,isCurrentUser,timestamp,imageUrl,messageId,seenStatus=!1,userColor=null){const messageElement=document.createElement("div");messageElement.className=isCurrentUser?"message user":"message receiver";if(messageId){messageElement.dataset.messageId=messageId}
const contentElement=document.createElement("div");contentElement.className="message-content";if(!isCurrentUser&&userColor){messageElement.style.background=userColor;const usernameElement=document.createElement("span");usernameElement.className="message-username";usernameElement.textContent=this.sanitizeInput(username);contentElement.appendChild(usernameElement)}
if(imageUrl){const imgElement=this.createImageElement(imageUrl);contentElement.appendChild(imgElement)}else if(message){const messageText=this.createTextElement(message);contentElement.appendChild(messageText)}
if(timestamp){const footer=this.createMessageFooter(timestamp,isCurrentUser,seenStatus);contentElement.appendChild(footer);messageElement.dataset.timestamp=timestamp}
messageElement.appendChild(contentElement);return messageElement},createImageElement(imageUrl){const imgElement=document.createElement("img");imgElement.src=this.sanitizeInput(imageUrl);imgElement.alt="User uploaded image";imgElement.style.cssText="max-width: 100%; max-height: 300px; border-radius: 12px; cursor: pointer; margin: 5px 0;";imgElement.onclick=()=>window.open(imageUrl,"_blank");return imgElement},createTextElement(message){const messageText=document.createElement("div");messageText.className="message-text";messageText.style.cssText="word-wrap: break-word; white-space: pre-wrap;";messageText.textContent=message;return messageText},createMessageFooter(timestamp,isCurrentUser,seenStatus){const messageFooter=document.createElement("div");messageFooter.className="message-footer";messageFooter.style.cssText='display: flex; justify-content: flex-end; align-items: center; gap: 10px; margin-top: 5px;';const timeElement=document.createElement("span");timeElement.className="message-time";timeElement.textContent=this.formatTimestamp(timestamp);if(isCurrentUser&&seenStatus){const seenElement=document.createElement('i');seenElement.className='fas fa-check-double seen-status';messageFooter.appendChild(seenElement)}
messageFooter.appendChild(timeElement);return messageFooter},formatTimestamp(timestamp){const messageDate=new Date(timestamp);const now=new Date();if(messageDate.toDateString()===now.toDateString()){return messageDate.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}else if(messageDate.getFullYear()===now.getFullYear()){return messageDate.toLocaleDateString([],{month:'short',day:'numeric'})}else{return messageDate.toLocaleDateString()}},updateMessageSeenStatus(messageId,seenBy,currentUser,isSmallRoom){const messageElement=document.querySelector(`.message[data-message-id='${messageId}']`);if(!messageElement)return;if(!isSmallRoom){const viewers=seenBy.filter(user=>user!==currentUser);let statusElement=messageElement.querySelector('.message-status-text');if(viewers.length>0){const seenText=`Seen: ${viewers.join(', ')}`;if(!statusElement){const messageFooter=messageElement.querySelector('.message-footer');if(!messageFooter)return;statusElement=document.createElement('span');statusElement.classList.add('message-status-text');statusElement.style.cssText='font-size: 0.7rem; color: #FFFFFF;';const timeElement=messageFooter.querySelector('.message-time');if(timeElement){messageFooter.insertBefore(statusElement,timeElement)}else{messageFooter.appendChild(statusElement)}}
statusElement.textContent=seenText;const doubleTick=messageElement.querySelector('.seen-status');if(doubleTick){doubleTick.remove();messageElement.classList.remove('seen')}}else{if(statusElement)statusElement.remove();}}else{const messageFooter=messageElement.querySelector('.message-footer');const existingSeenIcon=messageElement.querySelector('.seen-status');if(messageFooter&&!existingSeenIcon&&messageElement.classList.contains('user')){const seenElement=document.createElement('i');seenElement.className='fas fa-check-double seen-status';messageFooter.insertBefore(seenElement,messageFooter.firstChild);messageElement.classList.add('seen')}}},clearSeenStatus(){const messagesContainer=document.getElementById('messages');if(!messagesContainer)return;messagesContainer.querySelectorAll('.message.user.seen').forEach((messageElement)=>{messageElement.classList.remove('seen');const seenIcon=messageElement.querySelector('.seen-status');if(seenIcon)seenIcon.remove();})},updateUsernameVisibility(isOneOnOne){const messagesContainer=document.getElementById('messages');if(!messagesContainer)return;const allMessages=messagesContainer.querySelectorAll('.message.receiver');allMessages.forEach(messageEl=>{const usernameEl=messageEl.querySelector('.message-username');if(usernameEl){usernameEl.style.display=isOneOnOne?'none':'block'}})},createChatHistory(currentUser){const messagesContainer=document.getElementById('messages');if(!messagesContainer)return null;const messageElements=messagesContainer.querySelectorAll('.message:not(.hidden)');const history=[];messageElements.forEach(el=>{const usernameEl=el.querySelector('.message-username');let username;if(el.classList.contains('user')){username=currentUser}else{username=usernameEl?.textContent||'Unknown User'}
const text=el.querySelector('.message-text')?.textContent||"";const timestamp=el.dataset.timestamp;const imageUrl=el.querySelector('img')?.src||"";const messageId=el.dataset.messageId;history.push({id:messageId,user:username,message:text,imageUrl:imageUrl,timestamp:timestamp?new Date(timestamp).toISOString():new Date().toISOString()})});return history},sanitizeInput(input){const div=document.createElement('div');div.textContent=input;return div.innerHTML}};if(typeof module!=="undefined"){module.exports=MessageRenderer}
if(typeof window!=="undefined"){window.MessageRenderer=MessageRenderer}
