const SocketHandler={socket:null,init(socketInstance){this.socket=socketInstance;this.registerListeners();return this;},registerListeners(){this.socket.on('connect',this.onConnect.bind(this));this.socket.on('disconnect',this.onDisconnect.bind(this));this.socket.on('connectionError',this.onConnectionError.bind(this));this.socket.on('error',this.onError.bind(this));this.socket.on('joinError',this.onJoinError.bind(this));this.socket.on('joinConfirmed',this.onJoinConfirmed.bind(this));this.socket.on('userPublicKey',this.onUserPublicKey.bind(this));this.socket.on('roomPublicKeys',this.onRoomPublicKeys.bind(this));this.socket.on('previousMessages',this.onPreviousMessages.bind(this));this.socket.on('chatMessage',this.onChatMessage.bind(this));this.socket.on('updateActiveUsers',this.onUpdateActiveUsers.bind(this));this.socket.on('messageStatusUpdate',this.onMessageStatusUpdate.bind(this));this.socket.on('messageSeen',this.onMessageSeen.bind(this));this.socket.on('typing',this.onTyping.bind(this));this.socket.on('stopTyping',this.onStopTyping.bind(this));},onConnect(){console.log("Connected to server with ID:",this.socket.id);if(this.onConnectionChange){this.onConnectionChange(true);}if(this.onReconnect){this.onReconnect();}},onDisconnect(reason){console.log("Disconnected from server:",reason);if(this.onConnectionChange){this.onConnectionChange(false);}},onConnectionError({message}){console.error("Connection error:",message);if(this.onErrorReceived){this.onErrorReceived("Connection error:" + message);}},onError(message){console.error("Server Error:",message);if(this.onErrorReceived){this.onErrorReceived("Server Error:" + message);}},onJoinError(message){console.log("Join error:",message);if(this.onJoinFailed){this.onJoinFailed(message);}},async onJoinConfirmed({username,roomId,users}){console.log("Join confirmed:",roomId);if(this.onJoinSuccess){await this.onJoinSuccess({username,roomId,users});}},async onUserPublicKey({username,publicKey}){console.log(`E2EE:Received public key from ${username}`);if(this.onPublicKeyReceived){await this.onPublicKeyReceived(username,publicKey);}},async onRoomPublicKeys(publicKeys){console.log(`E2EE:Received ${Object.keys(publicKeys).length}public keys`);if(this.onRoomKeysReceived){await this.onRoomKeysReceived(publicKeys);}},async onPreviousMessages(messages){console.log(`Received ${messages.length}previous messages`);if(this.onHistoryReceived){await this.onHistoryReceived(messages);}},async onChatMessage(data){if(this.onMessageReceived){await this.onMessageReceived(data);}},onUpdateActiveUsers(users){if(this.onUsersUpdated){this.onUsersUpdated(users);}},onMessageStatusUpdate(data){if(this.onMessageStatusChanged){this.onMessageStatusChanged(data);}},onMessageSeen(data){if(this.onMessageSeenUpdate){this.onMessageSeenUpdate(data);}},onTyping(username){if(this.onUserTyping){this.onUserTyping(username);}},onStopTyping(username){if(this.onUserStoppedTyping){this.onUserStoppedTyping(username);}},joinRoom(token,roomId,integrityToken,integrityScore){this.socket.emit('joinRoom',{token,roomId,integrityToken,integrityScore});},sharePublicKey(roomId,publicKey){this.socket.emit('sharePublicKey',{roomId,publicKey});},sendMessage(roomId,encryptedData){this.socket.emit('chatMessage',{roomId,encryptedData});},typing(roomId){this.socket.emit('typing',roomId);},stopTyping(roomId){this.socket.emit('stopTyping',roomId);},markAllSeen(roomId){this.socket.emit('markAllSeen',{roomId});},leaveRoom(){this.socket.emit('leaveRoom');},isConnected(){return this.socket && this.socket.connected;},getSocketId(){return this.socket ? this.socket.id:null;}};if(typeof module !=="undefined"){module.exports=SocketHandler;}if(typeof window !=="undefined"){window.SocketHandler=SocketHandler;}
