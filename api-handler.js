const APIHandler={async authenticate(username){try{const response=await fetch('/api/auth/token',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username})});const result=await response.json();if(!response.ok){throw new Error(result.error||'Failed to get authentication token.')}
return result.token}catch(error){console.error('Authentication Error:',error);throw error}},async loadOlderMessages(roomId,beforeMessageId,limit=20){try{const url=`/api/messages/${roomId}?before=${beforeMessageId}&limit=${limit}`;const response=await fetch(url);if(!response.ok){throw new Error(`HTTP error! status: ${response.status}`)}
const data=await response.json();return data.messages||[]}catch(error){console.error('Failed to load older messages:',error);throw error}},async uploadImage(imageFile,roomId,token){try{if(!imageFile||!roomId||!token){throw new Error('Missing required parameters for image upload')}
const formData=new FormData();formData.append('image',imageFile);formData.append('roomId',roomId);const response=await fetch('/upload',{method:'POST',body:formData,headers:{'Authorization':`Bearer ${token}`}});const result=await response.json();if(!response.ok){throw new Error(result.error||'Upload failed')}
return result}catch(error){console.error('Image upload error:',error);throw error}},async checkHealth(){try{const response=await fetch('/health');if(!response.ok){throw new Error('Health check failed')}
return await response.json()}catch(error){console.error('Health check error:',error);throw error}}};if(typeof module!=="undefined"){module.exports=APIHandler}
if(typeof window!=="undefined"){window.APIHandler=APIHandler}
