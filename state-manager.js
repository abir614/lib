const StateManager={currentUser:null,currentRoomId:null,isJoined:!1,userToken:null,autoScrollEnabled:!0,isLoadingMoreMessages:!1,lastMessageId:null,imageFile:null,roomUsers:[],totalRoomUsers:0,userColors:{},displayedUsernames:new Set(),typingUsers:new Set(),joinTimeout:null,typingTimeout:null,seenTimeout:null,USER_COLORS:["#28a745","#dc3545","#ffc107","#6f42c1","#fd7e14","#20c997","#e83e8c","#6c757d","#17a2b8"],CONFIG:{maxMessageLength:500,maxFileSize:5*1024*1024,typingDebounce:1000,seenDebounce:100,usernameDisplayTimeout:10000},reset(){this.currentUser=null;this.currentRoomId=null;this.isJoined=!1;this.userToken=null;this.autoScrollEnabled=!0;this.isLoadingMoreMessages=!1;this.lastMessageId=null;this.imageFile=null;this.roomUsers=[];this.totalRoomUsers=0;this.userColors={};this.displayedUsernames.clear();this.typingUsers.clear();this.clearTimeouts()},clearTimeouts(){if(this.joinTimeout)clearTimeout(this.joinTimeout);if(this.typingTimeout)clearTimeout(this.typingTimeout);if(this.seenTimeout)clearTimeout(this.seenTimeout);this.joinTimeout=null;this.typingTimeout=null;this.seenTimeout=null},updateRoomUsers(users){this.roomUsers=users;this.totalRoomUsers=users.length},assignUserColor(username){if(!this.userColors[username]){const colorIndex=Object.keys(this.userColors).length%this.USER_COLORS.length;this.userColors[username]=this.USER_COLORS[colorIndex]}
return this.userColors[username]},isOneOnOneChat(){return this.totalRoomUsers===2},getOtherUsers(){return this.roomUsers.map(u=>u.username).filter(username=>username!==this.currentUser)},getEncryptionRecipients(){const recipients=this.roomUsers.map(u=>u.username).filter(Boolean);if(!recipients.includes(this.currentUser)){recipients.push(this.currentUser)}
return recipients},addTypingUser(username){if(username!==this.currentUser&&username!=='System'){this.typingUsers.add(username);return!0}
return!1},removeTypingUser(username){return this.typingUsers.delete(username)},getTypingUsers(){return Array.from(this.typingUsers).filter(u=>u!==this.currentUser&&u!=='System')},setImageFile(file){this.imageFile=file},clearImageFile(){this.imageFile=null},debug(){return{currentUser:this.currentUser,currentRoomId:this.currentRoomId,isJoined:this.isJoined,totalRoomUsers:this.totalRoomUsers,typingUsers:Array.from(this.typingUsers),hasToken:!!this.userToken,hasImage:!!this.imageFile}}};if(typeof module!=="undefined"){module.exports=StateManager}
if(typeof window!=="undefined"){window.StateManager=StateManager}
